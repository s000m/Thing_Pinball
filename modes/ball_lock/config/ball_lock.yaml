#config_version=6

mode:
  start_events: mode_ball_lock_start
  stop_events: mode_ball_lock_complete, ball_ending
  priority: 350
  code: ball_lock.BallLock
  
slide_player:
  mode_ball_lock_started:
    ball_lock_started:
      widgets:
        - type: text
          text: BALL LOCK MODE ACTIVE
          font_size: 50
          y: center-100
          color: blue
          expire: 2s
          
  ball_locked:
    ball_locked_display:
      widgets:
        - type: text
          text: "BALL LOCKED: (player|locked_balls) / 3"
          font_size: 40
          y: center
          color: yellow
          expire: 2s

  right_orbit_hit:
    orbit_active:
      widgets:
        - type: text
          text: "ORBIT ACTIVE!"
          font_size: 40
          y: center
          color: green
          expire: 1s

variable_player:
  ball_locked:
    locked_balls: 1
    score: 50000
  
  ball_lock_complete:
    score: 100000
    
  mode_ball_lock_complete:
    ball_lock_complete: 1
    game_mode_active: 0
    
  set_ball_lock_active:
    ball_lock_active:
      action: set
      int: 1
  
  clear_ball_lock_active:
    ball_lock_active:
      action: set
      int: 0
    
timers:
  ball_lock_timer:
    start_value: 60
    end_value: 0
    direction: down
    control_events:
      - event: mode_ball_lock_started
        action: start
      - event: ball_lock_complete
        action: stop
    events_when_complete: ball_lock_timer_expired
    
# Event player setup
event_player:
  mode_ball_lock_started: 
    - open_ramp_release  # Initial pulse when mode starts
    - set_ball_lock_active
  
  mode_ball_lock_stopped: 
    - clear_ball_lock_active
  
  ball_lock_timer_expired: ball_lock_failed
  
  s_right_orbit_1_active: 
    - right_orbit_hit
    - pulse_upramp
    - open_ramp_release|3s  # Delayed pulse for ramp release
  
  # Ball lock handling
  "balldevice_bd_ball_lock_ball_count{value==3}": ball_lock_full
  ball_lock_full: ball_lock_complete
  ball_lock_complete: 
    - mode_ball_lock_ending
    - disable_up_post|3100  # Schedule disable after slightly longer than enable_ms

# Coil player for device control
coil_player:
  open_ramp_release:
    c_ramp_release:
      action: pulse
      
  pulse_upramp:
    c_upramp:
      action: pulse
      
  release_locked_balls:
    c_up_post:
      action: pulse
      
  ball_lock_complete:
    c_up_post:
      action: enable
      enable_ms: 3000
      
  disable_up_post:
    c_up_post:
      action: disable